<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Screener | Match Your Resume with Job Descriptions</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .drag-active {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-robot text-indigo-600 text-2xl mr-2"></i>
                    <span class="font-semibold text-xl text-gray-800">AI Resume Screener</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500 hidden sm:block">Powered by Machine Learning</span>
                    <i class="fa-solid fa-microchip text-indigo-500"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                Find Your Perfect <span class="text-indigo-600">Match</span>
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Upload your resume and paste the job description to see how well they align using AI-powered similarity scoring.
            </p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
            <div class="grid md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-200">
                
                <!-- Left Column - Resume Upload -->
                <div class="p-8">
                    <div class="flex items-center mb-6">
                        <div class="bg-indigo-100 rounded-lg p-3 mr-4">
                            <i class="fa-solid fa-file-lines text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800">Upload Resume</h2>
                            <p class="text-sm text-gray-500">PDF or DOCX (Max 16MB)</p>
                        </div>
                    </div>

                    <!-- Drag & Drop Zone -->
                    <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-400 transition-colors duration-200 cursor-pointer bg-gray-50">
                        <i class="fa-solid fa-cloud-upload-alt text-4xl text-indigo-400 mb-3"></i>
                        <p class="text-gray-600 mb-2">Drag and drop your resume here</p>
                        <p class="text-sm text-gray-400 mb-4">or</p>
                        <label for="resumeInput" class="inline-block bg-indigo-600 text-white px-6 py-2 rounded-lg font-medium text-sm hover:bg-indigo-700 transition-colors duration-200 cursor-pointer shadow-sm">
                            Browse Files
                        </label>
                        <input type="file" id="resumeInput" accept=".pdf,.docx" class="hidden">
                        <p id="fileName" class="mt-4 text-sm text-indigo-600 font-medium hidden"></p>
                    </div>

                    <!-- File Preview (hidden by default) -->
                    <div id="filePreview" class="mt-4 p-4 bg-indigo-50 rounded-lg hidden">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fa-solid fa-file-pdf text-indigo-600 mr-3"></i>
                                <span id="previewFileName" class="text-sm font-medium text-gray-700">resume.pdf</span>
                            </div>
                            <button id="removeFile" class="text-gray-400 hover:text-red-500 transition-colors">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Job Description -->
                <div class="p-8">
                    <div class="flex items-center mb-6">
                        <div class="bg-indigo-100 rounded-lg p-3 mr-4">
                            <i class="fa-solid fa-briefcase text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800">Job Description</h2>
                            <p class="text-sm text-gray-500">Paste the job requirements</p>
                        </div>
                    </div>

                    <!-- Job Description Textarea -->
                    <textarea id="jobDescription" rows="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none text-sm" placeholder="Paste the job description here... (e.g., Required Skills: Python, Machine Learning, 3+ years experience in web development...)"></textarea>
                    
                    <!-- Character Count -->
                    <div class="flex justify-end mt-2">
                        <span id="charCount" class="text-xs text-gray-400">0 characters</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-gray-50 px-8 py-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                <div class="text-sm text-gray-500">
                    <i class="fa-solid fa-circle-info text-indigo-500 mr-1"></i>
                    Your files are processed locally and never stored permanently.
                </div>
                <div class="flex gap-3 w-full sm:w-auto">
                    <button id="clearBtn" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors duration-200 font-medium text-sm w-full sm:w-auto">
                        Clear All
                    </button>
                    <button id="analyzeBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 font-medium text-sm shadow-sm disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto" disabled>
                        <i class="fa-solid fa-magnifying-glass mr-2"></i>
                        Analyze Match
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="mt-8 bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 hidden">
            <div class="p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fa-solid fa-chart-pie text-indigo-600 mr-3"></i>
                    Analysis Results
                </h2>

                <!-- Score Card -->
                <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-lg font-semibold text-gray-700">Match Score</span>
                        <span id="scoreValue" class="text-3xl font-bold text-indigo-600">0%</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                        <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-blue-600 h-4 rounded-full progress-bar" style="width: 0%"></div>
                    </div>
                    
                    <!-- Score Interpretation -->
                    <p id="scoreMessage" class="text-sm text-gray-600 mt-2">
                        Enter both resume and job description to see the match score.
                    </p>
                </div>

                <!-- Keywords Grid -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa-solid fa-tags text-indigo-500 mr-2"></i>
                        Key Matching Terms
                    </h3>
                    <div id="keywordsContainer" class="flex flex-wrap gap-2">
                        <!-- Keywords will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Section (add after results section) -->
<div id="feedbackSection" class="mt-6 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hidden">
    <div class="p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <i class="fa-regular fa-star text-yellow-500 mr-2"></i>
            Help Improve the AI
        </h3>
        
        <p class="text-sm text-gray-600 mb-4">
            Was this match accurate? Your feedback helps train the model to be better!
        </p>
        
        <div class="flex flex-wrap gap-3 mb-4">
            <button id="feedbackAccurate" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 text-sm font-medium">
                <i class="fa-regular fa-thumbs-up mr-1"></i> Yes, Accurate
            </button>
            <button id="feedbackInaccurate" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 text-sm font-medium">
                <i class="fa-regular fa-thumbs-down mr-1"></i> No, Inaccurate
            </button>
            <button id="feedbackExcellent" class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors duration-200 text-sm font-medium">
                <i class="fa-regular fa-face-smile mr-1"></i> Excellent Match!
            </button>
            <button id="feedbackPoor" class="px-4 py-2 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors duration-200 text-sm font-medium">
                <i class="fa-regular fa-face-frown mr-1"></i> Poor Match
            </button>
        </div>
        
        <div id="feedbackInputContainer" class="hidden">
            <textarea id="feedbackText" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm mb-3" placeholder="Additional comments (optional)"></textarea>
            
            <div class="flex gap-2">
                <button id="submitFeedback" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 text-sm font-medium">
                    Submit Feedback
                </button>
                <button id="cancelFeedback" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors duration-200 text-sm font-medium">
                    Cancel
                </button>
            </div>
        </div>
        
        <div id="feedbackSuccess" class="hidden text-sm text-green-600 bg-green-50 p-3 rounded-lg">
            <i class="fa-regular fa-circle-check mr-1"></i> Thank you for your feedback! It helps improve the system.
        </div>
        
        <!-- Model Info Badge -->
        <div id="modelInfoBadge" class="mt-4 pt-4 border-t border-gray-200 text-xs text-gray-500 flex items-center">
            <i class="fa-solid fa-microchip mr-1"></i>
            <span id="modelInfoText">Using similarity-based matching</span>
        </div>
    </div>
</div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 shadow-xl">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                <p class="mt-4 text-gray-600 font-medium">Analyzing your resume...</p>
            </div>
        </div>

        <!-- Error Toast -->
        <div id="errorToast" class="hidden fixed bottom-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg max-w-md">
            <div class="flex items-center">
                <i class="fa-solid fa-exclamation-circle mr-2"></i>
                <span id="errorMessage"></span>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/80 backdrop-blur-sm border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <p class="text-center text-sm text-gray-500">
                Built with Flask, scikit-learn, and Tailwind CSS • Deployed on Render
            </p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const resumeInput = document.getElementById('resumeInput');
        const fileName = document.getElementById('fileName');
        const filePreview = document.getElementById('filePreview');
        const previewFileName = document.getElementById('previewFileName');
        const removeFile = document.getElementById('removeFile');
        const jobDescription = document.getElementById('jobDescription');
        const charCount = document.getElementById('charCount');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsSection = document.getElementById('resultsSection');
        const scoreValue = document.getElementById('scoreValue');
        const progressBar = document.getElementById('progressBar');
        const scoreMessage = document.getElementById('scoreMessage');
        const keywordsContainer = document.getElementById('keywordsContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorToast = document.getElementById('errorToast');
        const errorMessage = document.getElementById('errorMessage');

        let selectedFile = null;

        // Drag & Drop Events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.add('drag-active');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.remove('drag-active');
            });
        });

        dropZone.addEventListener('drop', handleDrop, false);
        dropZone.addEventListener('click', () => resumeInput.click());
        resumeInput.addEventListener('change', handleFileSelect);
        removeFile.addEventListener('click', removeSelectedFile);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        function handleFile(file) {
            const validTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            const maxSize = 16 * 1024 * 1024; // 16MB

            if (!validTypes.includes(file.type)) {
                showError('Please upload a PDF or DOCX file.');
                return;
            }

            if (file.size > maxSize) {
                showError('File size must be less than 16MB.');
                return;
            }

            selectedFile = file;
            updateFilePreview(file.name);
            checkFormValidity();
        }

        function updateFilePreview(name) {
            dropZone.classList.add('hidden');
            filePreview.classList.remove('hidden');
            previewFileName.textContent = name;
        }

        function removeSelectedFile() {
            selectedFile = null;
            resumeInput.value = '';
            dropZone.classList.remove('hidden');
            filePreview.classList.add('hidden');
            checkFormValidity();
        }

        // Job Description Character Count
        jobDescription.addEventListener('input', () => {
            const count = jobDescription.value.length;
            charCount.textContent = `${count} characters`;
            checkFormValidity();
        });

        function checkFormValidity() {
            const hasFile = selectedFile !== null;
            const hasJobDesc = jobDescription.value.trim().length > 0;
            analyzeBtn.disabled = !(hasFile && hasJobDesc);
        }

        // Clear All
        clearBtn.addEventListener('click', () => {
            removeSelectedFile();
            jobDescription.value = '';
            charCount.textContent = '0 characters';
            resultsSection.classList.add('hidden');
            checkFormValidity();
        });

        // Analyze
        analyzeBtn.addEventListener('click', async () => {
            if (!selectedFile || !jobDescription.value.trim()) {
                showError('Please upload a resume and enter a job description.');
                return;
            }

            // Show loading spinner
            loadingSpinner.classList.remove('hidden');

            // Prepare form data
            const formData = new FormData();
            formData.append('resume', selectedFile);
            formData.append('job_description', jobDescription.value);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.error) {
                    showError(data.error);
                } else {
                    displayResults(data);
                }
            } catch (error) {
                showError('An error occurred while analyzing. Please try again.');
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        });

        function displayResults(data) {
            // Update score
            const score = data.score;
            scoreValue.textContent = `${score}%`;
            progressBar.style.width = `${score}%`;

            // Update score message
            if (score >= 80) {
                scoreMessage.textContent = 'Excellent match! This resume aligns very well with the job requirements.';
            } else if (score >= 60) {
                scoreMessage.textContent = 'Good match! The resume covers many key requirements.';
            } else if (score >= 40) {
                scoreMessage.textContent = 'Moderate match. Consider highlighting relevant skills more prominently.';
            } else {
                scoreMessage.textContent = 'Low match. The resume may need significant adjustments for this role.';
            }

            // Update keywords
            keywordsContainer.innerHTML = '';
            if (data.keywords && data.keywords.length > 0) {
                data.keywords.forEach(keyword => {
                    const badge = document.createElement('span');
                    badge.className = 'px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium';
                    badge.textContent = keyword;
                    keywordsContainer.appendChild(badge);
                });
            } else {
                keywordsContainer.innerHTML = '<p class="text-gray-500 text-sm">No significant keyword matches found.</p>';
            }

            // Show results section
            resultsSection.classList.remove('hidden');
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorToast.classList.remove('hidden');
            setTimeout(() => {
                errorToast.classList.add('hidden');
            }, 5000);
        }


        // Feedback functionality
let currentAnalysis = null;

// After displaying results, show feedback section
function displayResults(data) {
    // ... existing display code ...
    
    // Store current analysis for feedback
    currentAnalysis = {
        resumeText: selectedFile ? 'sample' : null, // In production, you'd store actual text
        jobDescription: jobDescription.value,
        score: data.score,
        ai_score: data.score,
        method: data.method
    };
    
    // Show feedback section
    document.getElementById('feedbackSection').classList.remove('hidden');
    
    // Update model info
    const modelInfoText = document.getElementById('modelInfoText');
    if (data.method === 'ml_regression' || data.method === 'ml_classification') {
        modelInfoText.innerHTML = `Using AI Model • Confidence: ${data.confidence_level} (${(data.confidence * 100).toFixed(0)}%) • ${data.models_used.join(', ')}`;
    } else {
        modelInfoText.innerHTML = `Using ${data.method.replace('_', ' ')} • No ML model loaded yet`;
    }
}

// Feedback handlers
document.getElementById('feedbackAccurate').addEventListener('click', () => {
    showFeedbackInput('accurate');
});

document.getElementById('feedbackInaccurate').addEventListener('click', () => {
    showFeedbackInput('inaccurate');
});

document.getElementById('feedbackExcellent').addEventListener('click', () => {
    submitFeedback('excellent', 90, true);
});

document.getElementById('feedbackPoor').addEventListener('click', () => {
    submitFeedback('poor', 20, false);
});

function showFeedbackInput(type) {
    document.getElementById('feedbackInputContainer').classList.remove('hidden');
    // Store feedback type
    window.currentFeedbackType = type;
}

document.getElementById('submitFeedback').addEventListener('click', async () => {
    const feedbackText = document.getElementById('feedbackText').value;
    const isAccurate = window.currentFeedbackType === 'accurate';
    
    await submitFeedback(window.currentFeedbackType, null, isAccurate, feedbackText);
});

document.getElementById('cancelFeedback').addEventListener('click', () => {
    document.getElementById('feedbackInputContainer').classList.add('hidden');
    document.getElementById('feedbackText').value = '';
});

async function submitFeedback(type, userScore, isAccurate, feedbackText = '') {
    if (!currentAnalysis) return;
    
    try {
        const response = await fetch('/feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                resume_text: currentAnalysis.resumeText,
                job_description: currentAnalysis.jobDescription,
                ai_score: currentAnalysis.score,
                user_score: userScore,
                is_accurate: isAccurate,
                feedback: feedbackText
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show success message
            document.getElementById('feedbackInputContainer').classList.add('hidden');
            document.getElementById('feedbackSuccess').classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                document.getElementById('feedbackSuccess').classList.add('hidden');
            }, 3000);
        }
    } catch (error) {
        console.error('Feedback error:', error);
    }
}

// Load model info on page load
async function loadModelInfo() {
    try {
        const response = await fetch('/model-info');
        const data = await response.json();
        
        const badge = document.getElementById('modelInfoBadge');
        if (badge) {
            if (data.status === 'active') {
                badge.innerHTML = `<i class="fa-solid fa-microchip mr-1"></i> Using AI Model • ${data.type}`;
            } else {
                badge.innerHTML = `<i class="fa-solid fa-microchip mr-1"></i> ${data.message}`;
            }
        }
    } catch (error) {
        console.error('Error loading model info:', error);
    }
}

// Call on page load
loadModelInfo();
    </script>
</body>
</html>